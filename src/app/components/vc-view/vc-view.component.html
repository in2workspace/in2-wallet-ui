<ion-card
  (click)="openDetailModal()"
  tabindex="0"
  (keydown)="handleButtonKeydown($event, 'detail')"
  style="
    background-color:  whitesmoke;
    width: 300px;
    height: 200px;
    border-radius: 20px;
    border: 1px solid lightgrey;
    align-content: center;
  "
>
@if(credentialInput.lifeCycleStatus == "ISSUED"){
  <button
      (click)="unsignedInfo()"
      (keydown)="handleButtonKeydown($event, 'info')"
      class="request-signature-button"
    >
      <img
        src="../../../assets/icons/question_mark_black.png"
        alt="info"
        style="width: 18px; height: 18px"
      />
  </button>
}

  <div
    style="
      position: absolute;
      top: 0;
      right: 10;
      width: 50%;
      height: 50%;
      background-color: whitesmoke;
      border-radius: 0% 0% 75% 75%;
      transform: translateX(85%) translateY(-90%);
      z-index: 1;
    "
  ></div>
  <div style="height: 2%"></div>
  <ion-col>
    <ion-col style="margin-inline: 20px">
      @if(iconUrl){
        <img [src]="iconUrl" alt width="50" height="50" style="margin: 10px auto" />
      }
      @if(credentialInput.lifeCycleStatus == "EXPIRED") {
        <span class="status-ellipse status-expired">{{ "credentials.expiration" | translate }}</span>
      }
      @if(credentialInput.lifeCycleStatus == "REVOKED") {
        <span class="status-ellipse status-expired">{{ "vc-view.revoked" | translate }}</span>
      }
      </ion-col>
    <ion-col>
      <ion-col size="12">
        <ion-card-header
          style="margin-top:5px; padding: 0% !important; margin-inline: 20px; height: 28%"
        >
          <ion-row>
            <ion-card-title
              style="
                color: black;
                font-size: 12px;
                font-weight: bold;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
              "
            >
              {{
                credentialType
              }}
            </ion-card-title>
          </ion-row>
          @for(field of mappedFields; track field) {
            <ion-row>
              <ion-card-title style="color: grey; font-size: 12px; font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                {{ field.value }}
              </ion-card-title>
            </ion-row>       
          }
             
        </ion-card-header>
      </ion-col>

      <ion-col size="12" align-self-end style="margin-left: 15px; padding: 0% !important;">
        @if(showChip){
        <img
          (click)="qrView()"
          (keydown)="handleKeydown($event, 'qr')"
          src="assets/icons/41.png"
          alt="qr"
          role="alert"
          style="width: auto; height: 40px; cursor: pointer"
        />
        }

      </ion-col>
    </ion-col>
  </ion-col>
  <span></span>
  <ion-alert
    [isOpen]="isAlertOpenNotFound"
    class="custom-alert"
    [header]="'vc-view.warning-header' | translate"
    [message]="'vc-view.warning-msg' | translate"
    [buttons]="alertButtons"
    (didDismiss)="setOpenNotFound(false)"
  ></ion-alert>
  <ion-alert
    [isOpen]="isAlertExpirationOpenNotFound"
    class="custom-alert"
    [header]="'credentials.expiredCredential' | translate"
    [message]="'credentials.expiredText' | translate"
    [buttons]="[{ text: 'credentials.close' | translate, role: 'confirm' }]"
    (didDismiss)="setOpenExpirationNotFound(false)"
  ></ion-alert>
  <ion-modal
    [isOpen]="isModalOpen"
    style="--min-height: 20rem"
    id="example-modal"
    #modal
  >
    <ng-template>
      <div class="wrapper">
        <ion-header>
          <ion-toolbar>
            <ion-title>QR</ion-title>
            <ion-buttons slot="end">
              <ion-button
              (click)="setOpen(false)"
              (keydown)="handleButtonKeydown($event, 'close')"
              class=".close-button"
              style="width: 24px; height: 24px"
            >
              <ion-img src="assets/icons/close-button.png"></ion-img>
            </ion-button>

            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content style="min-height: 20rem">
          <qrcode
            [qrdata]="this.cred_cbor"
            [width]="315"
            [errorCorrectionLevel]="'L'"
            [margin]="5"
          ></qrcode>
        </ion-content>
      </div>
    </ng-template>
  </ion-modal>

  <ion-alert
    [isOpen]="isModalDeleteOpen"
    class="custom-alert"
    [header]="'vc-view.delete-header' | translate"
    [message]="'vc-view.delete-message' | translate"
    [buttons]="deleteButtons"
    (didDismiss)="setOpenDeleteNotFound(false)"
  ></ion-alert>

  <ion-alert
    [isOpen]="isModalUnsignedOpen"
    class="custom-alert-unsigned"
    [header]="'vc-view.unsigned-header' | translate"
    [message]="'vc-view.unsigned-message' | translate"
    [buttons]="unsignedButtons"
  ></ion-alert>

</ion-card>

<ion-modal [isOpen]="isDetailModalOpen" (didDismiss)="closeDetailModal()" class="credential-detail-modal">
  <ng-template>
    <ion-header>
      <ion-toolbar class="modal-toolbar">
        <ion-title class="modal-title">{{ "vc-fields.modal-title" | translate }}</ion-title>
        <ion-buttons slot="end">
          <ion-button fill="clear" (keydown)="closeDetailModal()" (click)="closeDetailModal()">
            <ion-icon name="close-outline" class="close-icon"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding modal-content">
      <ion-list>
        <ng-container *ngFor="let section of evaluatedSections">
          <div class="section">
            <div class="section-header">{{ section.section | translate }}</div>
            <ion-item *ngFor="let field of section.fields" lines="none" class="field-item compact-item">
              <ion-label class="field-label" *ngIf="field.label !== 'vc-fields.lear-credential-machine.credentialEncoded'">
                <strong>{{ field.label | translate }}:</strong> {{ field.value }}
              </ion-label>

              <div *ngIf="field.label === 'vc-fields.lear-credential-machine.credentialEncoded'" class="token-container">
                <div class="token-value ellipsis-text" [title]="field.value">
                  {{ field.value }}
                </div>
                <div class="token-actions">
                  <ion-button fill="clear" size="small" (click)="copyToClipboard(field.value)" (keydown)="copyToClipboard(field.value)">
                    <ion-icon name="copy-outline"></ion-icon>
                  </ion-button>
                </div>
              </div>
            </ion-item>

          </div>
        </ng-container>
      </ion-list>
    </ion-content>

    <ion-footer class="modal-footer">
      <ion-button color="primary" class="delete-button" (keydown)="deleteVC()" (click)="deleteVC()">
        {{ "vc-fields.delete" | translate }}
      </ion-button>
    </ion-footer>
  </ng-template>
</ion-modal>
